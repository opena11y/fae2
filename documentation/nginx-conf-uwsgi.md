# Configuration For Nginx with uWSGI

This Nginx Configuration was generated using [nginxconfig.io](https://nginxconfig.io).

It has not been tested in production by the author, I used it as a point of reference when working on my Nginx config as a reverse proxy.

I abandoned uWSGI after struggling to get it to work correctly, it might b just fine but I'm much more familiar with Apache and opted to go that route instead.

Additionally, I did notice that it uses `alias` in the directives for `/static/` and `/media/` locations when the Nginx docs state that `root` would be better to use so while it should work just fine and while it's probably better than most tutorials and snippets you'll find on by searching Google, Stack Overflow, Github etc. that's not to say there isn't room for improvement.

To keep it easy to reference, I disabled the "modular" structure that would have split this single file `.conf` file into smaller component files, that are suggested as a best practice.

It does NOT include settings to force HTTPS, add HSTS headers, or support HTTP2 but you can readily use it as a base and generate your own from it using the link in the comment at the top.

```
# Generated by nginxconfig.io
# https://www.digitalocean.com/community/tools/nginx#?0.domain=fae2.example.com&0.path=%2Fopt%2Ffae2&0.document_root=%2Fpublic_html&0.redirect=false&0.http2=false&0.force_https=false&0.hsts=false&0.php=false&0.python&0.django&0.proxy_pass=http:%2F%2F127.0.0.1:8080&resolver_cloudflare=false&file_structure=unified

user www-data;
pid /run/nginx.pid;
worker_processes auto;
worker_rlimit_nofile 65535;

events {
    multi_accept on;
    worker_connections 65535;
}

http {
    charset utf-8;
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    server_tokens off;
    log_not_found off;
    types_hash_max_size 2048;
    client_max_body_size 16M;

    # MIME
    include mime.types;
    default_type application/octet-stream;

    # logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log warn;

    # SSL
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:10m;
    ssl_session_tickets off;

    # Diffie-Hellman parameter for DHE ciphersuites
    ssl_dhparam /etc/nginx/dhparam.pem;

    # Mozilla Intermediate configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

    # OCSP Stapling
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 8.8.8.8 8.8.4.4 208.67.222.222 208.67.220.220 valid=60s;
    resolver_timeout 2s;

    # load configs
    include /etc/nginx/conf.d/*.conf;

    # fae2.example.com
    server {
        listen 80;
        listen [::]:80;
        listen 443 ssl;
        listen [::]:443 ssl;
    
        server_name fae2.example.com;
        set $base /opt/fae2;
        root $base/public_html;
    
        # SSL
        ssl_certificate /etc/letsencrypt/live/fae2.example.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/fae2.example.com/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/fae2.example.com/chain.pem;
    
        # security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
        
        # . files
        location ~ /\.(?!well-known) {
            deny all;
        }
    
        # Python
        location / {
            # default uwsgi_params
            include uwsgi_params;
            
            # uwsgi settings
            uwsgi_pass                      unix:/tmp/uwsgi.sock;
            uwsgi_param Host                $host;
            uwsgi_param X-Real-IP           $remote_addr;
            uwsgi_param X-Forwarded-For     $proxy_add_x_forwarded_for;
            uwsgi_param X-Forwarded-Proto   $http_x_forwarded_proto;
        }
    
        # Django media
        location /media/ {
            alias $base/media/;
        }
    
        # Django static
        location /static/ {
            alias $base/static/;
        }
    
        # favicon.ico
        location = /favicon.ico {
            log_not_found off;
            access_log off;
        }
        
        # robots.txt
        location = /robots.txt {
            log_not_found off;
            access_log off;
        }
        
        # assets, media
        location ~* \.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv)$ {
            expires 7d;
            access_log off;
        }
        
        # svg, fonts
        location ~* \.(?:svgz?|ttf|ttc|otf|eot|woff2?)$ {
            add_header Access-Control-Allow-Origin "*";
            expires 7d;
            access_log off;
        }
        
        # gzip
        gzip on;
        gzip_vary on;
        gzip_proxied any;
        gzip_comp_level 6;
        gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;
    }
}
```
